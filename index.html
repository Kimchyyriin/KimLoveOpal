<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Surprise for Opal üíû</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg0:#070A16;
      --bg1:#0A1026;
      --txt:#ECF2FF;
      --muted:rgba(236,242,255,.72);
      --stroke:rgba(255,255,255,.14);

      --pink:#ff6bd6;
      --cyan:#4df7ff;
      --vio:#8a6bff;
      --gold:#ffd37a;

      --shadow: 0 30px 120px rgba(0,0,0,.55);
      --radius: 26px;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:"Kanit", system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      color:var(--txt);
      background: radial-gradient(1000px 700px at 20% 10%, rgba(138,107,255,.18), transparent 60%),
                  radial-gradient(900px 700px at 80% 40%, rgba(77,247,255,.12), transparent 55%),
                  linear-gradient(180deg, var(--bg0), var(--bg1));
      overflow-x:hidden;
    }
    a{color:inherit;text-decoration:none}

    /* Scene (optimized for performance) */
    .scene{ position:fixed; inset:0; z-index:-2; overflow:hidden; }
    #stars{ position:absolute; inset:0; width:100%; height:100%; }
    .aurora{
      position:absolute; width:1000px; height:560px;
      filter: blur(28px); opacity:.58; border-radius: 999px;
      mix-blend-mode: screen;
      animation: drift 14s ease-in-out infinite;
      pointer-events:none;
    }
    .aurora.a1{
      left:-280px; top:-220px;
      background: radial-gradient(circle at 30% 40%, rgba(255,107,214,.52), transparent 55%),
                  radial-gradient(circle at 70% 30%, rgba(77,247,255,.36), transparent 55%);
    }
    .aurora.a2{
      right:-320px; top:10%;
      background: radial-gradient(circle at 20% 60%, rgba(138,107,255,.52), transparent 55%),
                  radial-gradient(circle at 70% 30%, rgba(255,211,122,.26), transparent 60%);
      animation-duration: 18s;
    }
    .aurora.a3{
      left:20%; bottom:-280px;
      background: radial-gradient(circle at 40% 40%, rgba(77,247,255,.30), transparent 60%),
                  radial-gradient(circle at 70% 40%, rgba(255,107,214,.25), transparent 65%);
      animation-duration: 22s;
    }
    @keyframes drift{
      0%,100%{ transform: translate3d(0,0,0) rotate(6deg); }
      50%{ transform: translate3d(2%,-2%,0) rotate(10deg); }
    }
    .grain{
      position:absolute; inset:-30%;
      background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='220' height='220'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.8' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='220' height='220' filter='url(%23n)' opacity='.25'/%3E%3C/svg%3E");
      opacity:.05; transform: rotate(8deg); pointer-events:none;
    }

    /* Layout */
    .wrap{
      min-height:100%;
      padding: 26px 16px 18px;
      width: min(1180px, 96vw);
      margin: 0 auto;
      display:flex;
      flex-direction:column;
      gap: 18px;
    }
    .top{
      display:flex; align-items:center; justify-content:space-between; gap:12px;
    }
    .brand{
      display:flex; align-items:center; gap:10px;
      padding:10px 12px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.18);
      border-radius:999px;
      backdrop-filter: blur(10px);
    }
    .logo{
      width:28px;height:28px; display:grid; place-items:center;
      border-radius:10px;
      background: linear-gradient(135deg, rgba(255,107,214,.35), rgba(77,247,255,.22));
      border:1px solid rgba(255,255,255,.16);
    }
    .brandText{ letter-spacing:.6px; font-weight:700; opacity:.92; }
    .chipRow{ display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
    .chip{
      font-size:12px; color: rgba(255,255,255,.80);
      padding:10px 12px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.18);
      backdrop-filter: blur(10px);
    }

    .hero{
      display:grid;
      grid-template-columns: 1.35fr .65fr;
      gap:14px;
      align-items:stretch;
    }
    @media (max-width: 980px){
      .hero{ grid-template-columns: 1fr; }
    }

    .card{
      position:relative;
      border-radius: var(--radius);
      padding: 26px;
      background: linear-gradient(135deg, rgba(255,255,255,.11), rgba(255,255,255,.06));
      border: 1px solid rgba(255,255,255,.14);
      box-shadow: var(--shadow);
      backdrop-filter: blur(12px);
      overflow:hidden;
      min-height: 540px;
    }
    .glowBorder{
      position:absolute; inset:-2px;
      border-radius: calc(var(--radius) + 2px);
      background: radial-gradient(900px 220px at 20% 0%, rgba(255,107,214,.22), transparent 60%),
                  radial-gradient(700px 220px at 70% 0%, rgba(77,247,255,.18), transparent 60%),
                  radial-gradient(900px 220px at 40% 100%, rgba(138,107,255,.14), transparent 60%);
      pointer-events:none;
      filter: blur(10px);
      opacity:.85;
    }

    .side{ display:grid; gap:14px; }
    .sideCard{
      border-radius:22px;
      padding:18px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.18);
      backdrop-filter: blur(10px);
      box-shadow: 0 18px 70px rgba(0,0,0,.35);
    }
    .sideCard.soft{ opacity:.92; }
    .sideCard h3{ margin:0 0 8px; font-size:18px; }
    .sideCard ul{ margin:0; padding-left:18px; color: rgba(255,255,255,.78); line-height:1.75; }
    .ctaLine{
      margin-top:12px; padding-top:12px;
      border-top:1px dashed rgba(255,255,255,.18);
      color: rgba(255,255,255,.88);
    }

    .foot{
      display:flex; gap:10px; align-items:center; justify-content:center;
      color: rgba(255,255,255,.62); font-size:12px;
      padding: 10px 0 0;
    }
    .footDot{
      width:6px;height:6px;border-radius:999px;
      background: linear-gradient(90deg, var(--cyan), var(--pink));
      box-shadow: 0 0 24px rgba(77,247,255,.35);
    }

    /* Typography + UI */
    .headline h1{
      margin:0 0 8px;
      font-size: clamp(30px, 3.8vw, 50px);
      line-height:1.06;
      letter-spacing:.2px;
    }
    .accent{
      background: linear-gradient(90deg, var(--pink), var(--cyan), var(--gold));
      -webkit-background-clip:text;
      background-clip:text;
      color:transparent;
    }
    .sub{ font-size: clamp(16px, 2vw, 20px); opacity:.7; margin-left:6px; }
    .lead{ margin:0; color: var(--muted); line-height:1.75; font-size:16px; max-width:66ch; }

    .controls{ margin-top:18px; display:grid; gap:16px; }

    .row2{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }
    @media (max-width: 720px){
      .row2{ grid-template-columns: 1fr; }
    }

    .field{ display:grid; gap:8px; }
    .field label{ font-size:13px; color: rgba(255,255,255,.80); }
    .field input{
      padding:14px 14px;
      border-radius:16px;
      border:1px solid rgba(255,255,255,.16);
      background: rgba(0,0,0,.20);
      color: var(--txt);
      outline:none;
      transition: border-color .15s ease, transform .15s ease;
    }
    .field input:focus{ border-color: rgba(77,247,255,.35); transform: translateY(-1px); }

    .buttons{ display:flex; gap:12px; flex-wrap:wrap; align-items:center; }

    .btn{
      position:relative;
      border-radius:16px;
      padding:12px 14px;
      border:1px solid rgba(255,255,255,.16);
      background: rgba(0,0,0,.20);
      color: var(--txt);
      cursor:pointer;
      transition: transform .12s ease, border-color .12s ease, background .12s ease;
      overflow:hidden;
      display:inline-flex;
      gap:10px;
      align-items:center;
      user-select:none;
      white-space:nowrap;
    }
    .btn:hover{ transform: translateY(-1px); border-color: rgba(255,255,255,.28); }
    .btn:active{ transform: translateY(1px) scale(.99); }

    .btn.primary{
      padding:12px 16px;
      background: linear-gradient(135deg, rgba(255,107,214,.30), rgba(138,107,255,.26), rgba(77,247,255,.20));
      border-color: rgba(255,255,255,.22);
    }
    .btnIcon{
      width:26px; height:26px;
      display:grid; place-items:center;
      border-radius:10px;
      background: rgba(0,0,0,.18);
      border:1px solid rgba(255,255,255,.16);
    }
    .btn.ghost{ background: rgba(0,0,0,.14); color: rgba(255,255,255,.85); }

    .btnShine{
      position:absolute;
      inset:-40% -30%;
      background: linear-gradient(110deg, transparent 35%, rgba(255,255,255,.20) 50%, transparent 65%);
      transform: translateX(-45%) rotate(10deg);
      animation: shine 2.8s ease-in-out infinite;
      pointer-events:none;
    }
    @keyframes shine{
      0%, 60% { transform: translateX(-55%) rotate(10deg); opacity: 0; }
      70% { opacity: .95; }
      100% { transform: translateX(55%) rotate(10deg); opacity: 0; }
    }

    .meta{ display:grid; gap:10px; }
    .metaRow{ display:flex; justify-content:space-between; gap:10px; flex-wrap:wrap; }
    #progressText{ font-size:12px; color: rgba(255,255,255,.78); }
    .hint{ font-size:12px; color: rgba(255,255,255,.55); }

    .bar{
      height:10px;border-radius:999px;
      background: rgba(255,255,255,.10);
      border:1px solid rgba(255,255,255,.10);
      overflow:hidden;
    }
    .barFill{
      height:100%; width:0%;
      background: linear-gradient(90deg, rgba(77,247,255,.70), rgba(255,107,214,.55), rgba(255,211,122,.45));
      transition: width .35s ease;
    }

    .mini{ margin-top:18px; display:flex; gap:10px; flex-wrap:wrap; opacity:.95; }
    .pill{
      font-size:12px;
      padding:8px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.16);
      backdrop-filter: blur(10px);
    }

    /* SPA pages */
    .page{ display:none; }
    .page.active{ display:block; }
    .navline{ margin-top: 14px; display:flex; justify-content:space-between; gap:10px; flex-wrap:wrap; }

    /* Surprise envelope */
    .envelopeWrap{
      margin-top: 14px;
      display:grid;
      place-items:center;
    }
    .envelope{
      width:min(520px, 94%);
      aspect-ratio: 16/10;
      position:relative;
      border-radius: 22px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.14);
      overflow:hidden;
      box-shadow: 0 24px 90px rgba(0,0,0,.35);
    }
    .envBack{
      position:absolute; inset:0;
      background:
        radial-gradient(600px 260px at 30% 15%, rgba(255,107,214,.20), transparent 60%),
        radial-gradient(520px 260px at 70% 85%, rgba(77,247,255,.14), transparent 60%),
        linear-gradient(135deg, rgba(255,255,255,.10), rgba(255,255,255,.04));
    }
    .envFlap{
      position:absolute;
      left:0; right:0; top:-2px;
      height:55%;
      background: linear-gradient(135deg, rgba(255,255,255,.10), rgba(255,255,255,.04));
      border-bottom:1px solid rgba(255,255,255,.12);
      clip-path: polygon(0 0, 100% 0, 50% 100%);
      transform-origin: top center;
      transition: transform .6s ease;
    }
    .envLetter{
      position:absolute;
      left:6%; right:6%;
      bottom:6%;
      height:72%;
      border-radius:18px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.18);
      transform: translateY(34%);
      transition: transform .6s ease;
      padding: 14px;
    }
    .envelope.open .envFlap{ transform: rotateX(170deg); }
    .envelope.open .envLetter{ transform: translateY(0%); }

    .typed{
      margin:0;
      white-space:pre-wrap;
      line-height:1.85;
      color: rgba(255,255,255,.92);
      font-size: 14px;
    }
    .small{ margin-top:10px; color: rgba(255,255,255,.68); font-size:12px; }

    /* Stats / timeline */
    .stats{
      margin-top: 14px;
      display:grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 12px;
    }
    @media (max-width: 860px){ .stats{ grid-template-columns: 1fr; } }
    .stat{
      border-radius: 18px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.16);
      padding: 14px;
    }
    .stat .k{ font-size:12px; color: rgba(255,255,255,.68); }
    .stat .v{ font-size: 22px; font-weight: 700; margin-top: 2px; }
    .timeline{
      margin-top: 12px;
      border-radius: 18px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.16);
      padding: 14px;
    }
    .tlRow{
      display:flex; gap:10px; align-items:flex-start;
      padding: 10px 0;
      border-bottom: 1px dashed rgba(255,255,255,.14);
    }
    .tlRow:last-child{ border-bottom:none; }
    .dot{
      width:10px; height:10px; border-radius:999px;
      background: linear-gradient(90deg, var(--cyan), var(--pink));
      box-shadow: 0 0 20px rgba(77,247,255,.25);
      margin-top: 6px;
      flex: 0 0 auto;
    }
    .tlText b{ color: rgba(255,255,255,.92); }
    .tlText{ color: rgba(255,255,255,.78); line-height: 1.7; font-size: 14px; }

    /* Unlock gifts */
    .grid{
      margin-top: 14px;
      display:grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 12px;
    }
    @media (max-width: 860px){ .grid{ grid-template-columns: repeat(2, minmax(0, 1fr)); } }
    @media (max-width: 520px){ .grid{ grid-template-columns: 1fr; } }
    .memCard{
      padding: 14px;
      border-radius: 18px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.16);
      cursor:pointer;
      transition: transform .12s ease, border-color .12s ease;
      min-height: 112px;
    }
    .memCard:hover{ transform: translateY(-1px); border-color: rgba(255,255,255,.28); }
    .memCard h4{ margin:0 0 6px; font-size:16px; }
    .memCard p{ margin:0; color: rgba(255,255,255,.74); font-size:13px; line-height:1.55; }
    .memCard.locked p{ filter: blur(6px); user-select:none; }
    .memCard.revealed{ border-color: rgba(77,247,255,.32); }

    /* Finale */
    .center{ text-align:center; }
    .bigHeart{
      font-size: 64px; line-height: 1; margin-top: 10px;
      text-shadow: 0 12px 50px rgba(255,107,214,.25);
      animation: pulse 1.8s ease-in-out infinite;
    }
    @keyframes pulse{
      0%,100%{ transform: scale(1); opacity: .95; }
      50%{ transform: scale(1.06); opacity: 1; }
    }
    .panel{
      margin-top: 16px;
      padding: 14px;
      border-radius: 16px;
      border: 1px dashed rgba(255,255,255,.22);
      background: rgba(0,0,0,.14);
    }
    .mono{
      font-family: ui-monospace, SFMono-Regular, Menlo, monospace;
      font-size: 12px;
      color: rgba(255,255,255,.82);
      overflow-wrap:anywhere;
    }

    @media (prefers-reduced-motion: reduce){
      .aurora{ animation:none; }
      .btnShine{ animation:none; }
      .bigHeart{ animation:none; }
    }
  </style>
</head>

<body>
  <div class="scene" aria-hidden="true">
    <canvas id="stars"></canvas>
    <div class="aurora a1"></div>
    <div class="aurora a2"></div>
    <div class="aurora a3"></div>
    <div class="grain"></div>
  </div>

  <main class="wrap">
    <header class="top">
      <div class="brand">
        <span class="logo">‚ú¶</span>
        <span class="brandText">ANNIVERSARY_SURPRISE</span>
      </div>
      <div class="chipRow">
        <div class="chip" id="chipTime"></div>
        <button class="chip" id="perfBtn" title="‡∏•‡∏î‡πÄ‡∏≠‡∏ü‡πÄ‡∏ü‡∏Å‡∏ï‡πå‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏•‡∏∑‡πà‡∏ô">Performance: ON</button>
      </div>
    </header>

    <section class="hero">
      <!-- MAIN CARD (pages) -->
      <div class="card">
        <div class="glowBorder"></div>

        <!-- PAGE 0: HOME -->
        <div class="page active" data-page="home">
          <div class="headline">
            <h1>
              ‡πÄ‡∏ã‡∏≠‡∏£‡πå‡πÑ‡∏û‡∏£‡∏™‡πå‡∏ß‡∏±‡∏ô‡∏Ñ‡∏£‡∏ö‡∏£‡∏≠‡∏ö<br>
              ‡∏ñ‡∏∂‡∏á <span class="accent" id="toNameBig">‡πÇ‡∏≠‡∏õ‡∏≠</span>
              <span class="sub">(opal)</span>
            </h1>
            <p class="lead">
              ‡πÉ‡∏™‡πà ‚Äú‡∏ß‡∏±‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Ñ‡∏ö/‡∏ß‡∏±‡∏ô‡∏Ñ‡∏£‡∏ö‡∏£‡∏≠‡∏ö‚Äù ‡πÅ‡∏•‡πâ‡∏ß‡πÑ‡∏õ‡πÄ‡∏õ‡∏¥‡∏î‡∏ã‡∏≠‡∏á‡∏à‡∏î‡∏´‡∏°‡∏≤‡∏¢‚Ä¶ ‡∏°‡∏µ‡∏≠‡∏∞‡πÑ‡∏£‡∏ã‡πà‡∏≠‡∏ô‡∏≠‡∏¢‡∏π‡πà‡∏Ç‡πâ‡∏≤‡∏á‡πÉ‡∏ô üíå
            </p>
          </div>

          <div class="controls">
            <div class="row2">
              <div class="field">
                <label>‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏ü‡∏ô</label>
                <input id="nameInput" maxlength="30" placeholder="‡πÇ‡∏≠‡∏õ‡∏≠ / opal" />
              </div>
              <div class="field">
                <label>‡∏ß‡∏±‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Ñ‡∏ö / ‡∏ß‡∏±‡∏ô‡∏Ñ‡∏£‡∏ö‡∏£‡∏≠‡∏ö (‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô)</label>
                <input id="dateInput" type="date" />
              </div>
            </div>

            <div class="buttons">
              <button class="btn primary" id="startBtn">
                <span class="btnIcon">üíå</span>
                <span>‡πÄ‡∏õ‡∏¥‡∏î‡∏ã‡∏≠‡∏á‡πÄ‡∏ã‡∏≠‡∏£‡πå‡πÑ‡∏û‡∏£‡∏™‡πå</span>
                <span class="btnShine" aria-hidden="true"></span>
              </button>

              <button class="btn ghost" id="skipBtn">‡∏Ç‡πâ‡∏≤‡∏°‡πÑ‡∏õ‡∏î‡∏π Timeline ‚Üí</button>
            </div>

            <div class="meta">
              <div class="metaRow">
                <span id="progressText">Progress: 0%</span>
                <span class="hint">*‡∏à‡∏≥‡∏ä‡∏∑‡πà‡∏≠/‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</span>
              </div>
              <div class="bar"><div id="barFill" class="barFill"></div></div>
            </div>
          </div>

          <div class="mini">
            <div class="pill">Surprise</div>
            <div class="pill">Anniversary</div>
            <div class="pill">One-file</div>
            <div class="pill">Optimized</div>
          </div>
        </div>

        <!-- PAGE 1: SURPRISE LETTER -->
        <div class="page" data-page="letter">
          <div class="headline">
            <h1>‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà 1: <span class="accent">‡∏ã‡∏≠‡∏á‡∏à‡∏î‡∏´‡∏°‡∏≤‡∏¢</span></h1>
            <p class="lead">‡πÅ‡∏ï‡∏∞‡∏ã‡∏≠‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠ ‚Äú‡πÄ‡∏õ‡∏¥‡∏î‚Äù ‡πÅ‡∏•‡πâ‡∏ß‡∏≠‡πà‡∏≤‡∏ô‡∏ä‡πâ‡∏≤‡πÜ ‡∏ô‡∏∞ <span id="toNameInline1" class="accent">‡πÇ‡∏≠‡∏õ‡∏≠</span> üôÇ</p>
          </div>

          <div class="envelopeWrap">
            <div class="envelope" id="envelope">
              <div class="envBack"></div>
              <div class="envFlap"></div>
              <div class="envLetter">
                <p id="typed" class="typed"></p>
                <div class="small" id="typedHint">‡∏Å‡∏î‡πÄ‡∏õ‡∏¥‡∏î‡∏ã‡∏≠‡∏á‡∏Å‡πà‡∏≠‡∏ô‡∏ô‡∏∞ üíå</div>
              </div>
            </div>
          </div>

          <div class="navline">
            <button class="btn ghost" data-nav="home">‚Üê ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö</button>
            <button class="btn primary" id="toTimelineBtn" disabled>
              <span class="btnIcon">‚è≥</span>
              <span>‡πÑ‡∏õ‡∏î‡∏π Timeline</span>
              <span class="btnShine" aria-hidden="true"></span>
            </button>
          </div>
        </div>

        <!-- PAGE 2: TIMELINE -->
        <div class="page" data-page="timeline">
          <div class="headline">
            <h1>‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà 2: <span class="accent">Anniversary Timeline</span></h1>
            <p class="lead">‡∏™‡∏£‡∏∏‡∏õ‡πÅ‡∏ö‡∏ö‡∏™‡∏±‡πâ‡∏ô‡πÜ ‡πÅ‡∏ï‡πà‡πÇ‡∏Ñ‡∏ï‡∏£‡∏à‡∏£‡∏¥‡∏á‡πÉ‡∏à üíû</p>
          </div>

          <div class="stats">
            <div class="stat">
              <div class="k">‡∏Ñ‡∏ö‡∏Å‡∏±‡∏ô‡∏°‡∏≤‡πÅ‡∏•‡πâ‡∏ß</div>
              <div class="v" id="daysTogether">‚Äî</div>
              <div class="k">‡∏ß‡∏±‡∏ô</div>
            </div>
            <div class="stat">
              <div class="k">‡∏Ñ‡∏£‡∏ö‡∏£‡∏≠‡∏ö‡∏ñ‡∏±‡∏î‡πÑ‡∏õ‡πÉ‡∏ô‡∏≠‡∏µ‡∏Å</div>
              <div class="v" id="daysToNext">‚Äî</div>
              <div class="k">‡∏ß‡∏±‡∏ô</div>
            </div>
            <div class="stat">
              <div class="k">‡∏ß‡∏±‡∏ô‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤</div>
              <div class="v" id="datePretty">‚Äî</div>
              <div class="k">‡∏à‡∏≥‡πÑ‡∏î‡πâ‡πÄ‡∏™‡∏°‡∏≠</div>
            </div>
          </div>

          <div class="timeline">
            <div class="tlRow">
              <span class="dot"></span>
              <div class="tlText">
                <b>‡∏ß‡∏±‡∏ô‡∏ô‡∏±‡πâ‡∏ô</b> ‡πÄ‡∏£‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏°‡∏µ ‚Äú‡πÄ‡∏£‡∏≤‚Äù ‡πÅ‡∏•‡∏∞ ‚Äú‡πÄ‡∏ò‡∏≠‚Äù ‡πÄ‡∏õ‡πá‡∏ô ‚Äú‡πÄ‡∏£‡∏≤‚Äù ‡∏°‡∏≤‡∏Å‡∏Ç‡∏∂‡πâ‡∏ô
              </div>
            </div>
            <div class="tlRow">
              <span class="dot"></span>
              <div class="tlText">
                <b>‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</b> ‡πÄ‡∏£‡∏≤‡∏≠‡∏¢‡∏≤‡∏Å‡∏ö‡∏≠‡∏Å‡∏ß‡πà‡∏≤‚Ä¶ ‡πÄ‡∏£‡∏≤‡∏£‡∏±‡∏Å‡πÄ‡∏ò‡∏≠‡∏°‡∏≤‡∏Å‡∏Ç‡∏∂‡πâ‡∏ô‡∏Å‡∏ß‡πà‡∏≤‡πÄ‡∏î‡∏¥‡∏°‡∏ó‡∏∏‡∏Å‡∏ß‡∏±‡∏ô
              </div>
            </div>
            <div class="tlRow">
              <span class="dot"></span>
              <div class="tlText">
                <b>‡∏ï‡πà‡∏≠‡∏à‡∏≤‡∏Å‡∏ô‡∏µ‡πâ</b> ‡∏Ç‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏≤‡∏¢‡∏±‡∏á‡∏à‡∏±‡∏ö‡∏°‡∏∑‡∏≠‡∏Å‡∏±‡∏ô‡πÑ‡∏õ‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏¢‡πÜ ‡πÑ‡∏°‡πà‡∏£‡∏µ‡∏ö ‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡∏õ‡∏•‡πà‡∏≠‡∏¢
              </div>
            </div>
          </div>

          <div class="navline">
            <button class="btn ghost" data-nav="letter">‚Üê ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏≠‡πà‡∏≤‡∏ô‡∏à‡∏î‡∏´‡∏°‡∏≤‡∏¢</button>
            <button class="btn primary" id="toGiftsBtn">
              <span class="btnIcon">üéÅ</span>
              <span>‡πÑ‡∏õ‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Å‡∏Ç‡∏≠‡∏á‡∏Ç‡∏ß‡∏±‡∏ç</span>
              <span class="btnShine" aria-hidden="true"></span>
            </button>
          </div>
        </div>

        <!-- PAGE 3: GIFTS (unlock) -->
        <div class="page" data-page="gifts">
          <div class="headline">
            <h1>‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà 3: <span class="accent">‡∏Ç‡∏≠‡∏á‡∏Ç‡∏ß‡∏±‡∏ç‡∏ó‡∏µ‡πà‡∏ã‡πà‡∏≠‡∏ô‡∏≠‡∏¢‡∏π‡πà</span></h1>
            <p class="lead">‡∏Å‡∏î‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö 3 ‡πÉ‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Å ‚ÄúHappy Anniversary‚Äù</p>
          </div>

          <div class="grid" id="grid"></div>

          <div class="navline">
            <button class="btn ghost" data-nav="timeline">‚Üê ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö</button>
            <button class="btn primary" id="unlockBtn" disabled>
              <span class="btnIcon">üîì</span>
              <span>‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Å‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢</span>
              <span class="btnShine" aria-hidden="true"></span>
            </button>
          </div>
        </div>

        <!-- PAGE 4: FINALE -->
        <div class="page" data-page="finale">
          <div class="headline center">
            <div class="bigHeart" aria-hidden="true">‚ù§</div>
            <h1>Happy Anniversary<br><span class="accent" id="toNameInline5">‡πÇ‡∏≠‡∏õ‡∏≠</span></h1>
            <p class="lead" id="randomLine"></p>
          </div>

          <div class="panel">
            <div class="mono" id="hashLine"></div>
            <div class="small">*‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏Ç‡∏≠‡∏á ‚Äú‡πÄ‡∏£‡∏≤ & ‡πÄ‡∏ò‡∏≠‚Äù</div>
          </div>

          <div class="navline">
            <button class="btn ghost" id="regenBtn">‡∏™‡∏∏‡πà‡∏°‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏Ñ üé≤</button>
            <button class="btn primary" id="kissBtn">
              <span class="btnIcon">üíñ</span>
              <span>‡∏Å‡∏î‡∏£‡∏±‡∏ö‡πÄ‡∏ã‡∏≠‡∏£‡πå‡πÑ‡∏û‡∏£‡∏™‡πå</span>
              <span class="btnShine" aria-hidden="true"></span>
            </button>
          </div>

          <div class="navline" style="justify-content:flex-start">
            <button class="btn ghost" data-nav="home">‚Ü∫ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà</button>
          </div>
        </div>

      </div>

      <!-- SIDE -->
      <aside class="side">
        <div class="sideCard">
          <h3>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</h3>
          <ul>
            <li>To: <span class="accent" id="toNameSide">‡πÇ‡∏≠‡∏õ‡∏≠</span> (opal)</li>
            <li>‡∏ò‡∏µ‡∏°: Surprise + Anniversary</li>
            <li>‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Å‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏≤‡∏£‡πå‡∏î 3 ‡πÉ‡∏ö</li>
          </ul>
          <div class="ctaLine">‡∏™‡∏∏‡∏Ç‡∏™‡∏±‡∏ô‡∏ï‡πå‡∏ß‡∏±‡∏ô‡∏Ñ‡∏£‡∏ö‡∏£‡∏≠‡∏ö‡∏ô‡∏∞ <span class="accent" id="toNameSide2">‡πÇ‡∏≠‡∏õ‡∏≠</span> üôÇ</div>
        </div>

        <div class="sideCard soft">
          <h3>Tip</h3>
          <p style="margin:0;color:rgba(255,255,255,.76);line-height:1.7">
            ‡∏ñ‡πâ‡∏≤‡∏≠‡∏¢‡∏≤‡∏Å‡πÉ‡∏´‡πâ ‚Äú‡∏ï‡∏£‡∏á‡∏ß‡∏±‡∏ô‡∏à‡∏£‡∏¥‡∏á‚Äù ‡πÄ‡∏õ‡πä‡∏∞‡πÜ ‡πÉ‡∏´‡πâ‡πÉ‡∏™‡πà‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å ‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏ß‡πá‡∏ö‡∏à‡∏∞‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÉ‡∏´‡πâ‡πÄ‡∏≠‡∏á
          </p>
        </div>
      </aside>
    </section>

    <footer class="foot">
      <span class="footDot"></span>
      <span>Made with love ‚Ä¢ Anniversary Surprise</span>
    </footer>
  </main>

  <script>
    // ===== State =====
    const KEY = "anniv_surprise_v1";
    const state = {
      name: "‡πÇ‡∏≠‡∏õ‡∏≠",
      dateISO: "2027-01-14",      // YYYY-MM-DD
      step: 0,          // 0 home, 1 letter, 2 timeline, 3 gifts, 4 finale
      revealed: {},
      perf: true
    };

    // ===== Utilities =====
    const $ = (q, el=document) => el.querySelector(q);
    const $$ = (q, el=document) => Array.from(el.querySelectorAll(q));

    function load(){
      try{
        const raw = localStorage.getItem(KEY);
        if(raw) Object.assign(state, JSON.parse(raw));
      }catch{}
    }
    function save(){
      localStorage.setItem(KEY, JSON.stringify(state));
    }

    function setProgress(step){
      state.step = Math.max(state.step, step);
      save();
      syncProgressUI();
    }

    function progressPercent(){
      const pct = Math.round((Math.min(state.step, 4) / 4) * 100);
      return isFinite(pct) ? pct : 0;
    }

    function syncNames(){
      const show = state.name?.trim() || "‡πÇ‡∏≠‡∏õ‡∏≠";
      $("#toNameBig").textContent = show;
      $("#toNameInline1").textContent = show;
      $("#toNameInline5").textContent = show;
      $("#toNameSide").textContent = show;
      $("#toNameSide2").textContent = show;

      const nameInput = $("#nameInput");
      if(nameInput && !nameInput.value) nameInput.value = show;

      const dateInput = $("#dateInput");
      if(dateInput && state.dateISO && !dateInput.value) dateInput.value = state.dateISO;
    }

    function syncProgressUI(){
      const pct = progressPercent();
      const t = $("#progressText");
      const b = $("#barFill");
      if(t) t.textContent = `Progress: ${pct}%`;
      if(b) b.style.width = `${pct}%`;
    }

    // ===== Router =====
    function showPage(name){
      $$(".page").forEach(p => p.classList.toggle("active", p.dataset.page === name));
      location.hash = name;

      if(name === "home") setProgress(0);
      if(name === "letter") { setProgress(1); resetLetterUI(); }
      if(name === "timeline") { setProgress(2); renderTimeline(); }
      if(name === "gifts") { setProgress(3); renderGifts(); }
      if(name === "finale") { setProgress(4); refreshFinale(); }

      syncNames();
      syncProgressUI();
    }

    window.addEventListener("hashchange", () => {
      const page = (location.hash || "#home").slice(1);
      if(["home","letter","timeline","gifts","finale"].includes(page)) showPage(page);
    });

    // ===== Time chip =====
    function initTimeChip(){
      const chip = $("#chipTime");
      const tick = () => {
        const d = new Date();
        const hh = String(d.getHours()).padStart(2,"0");
        const mm = String(d.getMinutes()).padStart(2,"0");
        chip.textContent = `Bangkok ‚Ä¢ ${hh}:${mm}`;
      };
      tick();
      setInterval(tick, 10000);
    }

    // ===== Stars (optimized: 30fps, less stars, pause when hidden) =====
    function initStars(){
      const c = $("#stars");
      if(!c) return;
      const ctx = c.getContext("2d", { alpha: true });

      let w,h,stars,last=0,acc=0;
      let running = true;

      const resize = () => {
        const dpr = Math.min(devicePixelRatio || 1, state.perf ? 1.5 : 1.2);
        w = c.width  = Math.floor(innerWidth  * dpr);
        h = c.height = Math.floor(innerHeight * dpr);
        c.style.width = "100%";
        c.style.height = "100%";

        const base = state.perf ? 140 : 100;
        const count = Math.min(base, Math.floor((innerWidth * innerHeight) / (state.perf ? 12000 : 15000)));
        stars = Array.from({length: count}, () => ({
          x: Math.random()*w,
          y: Math.random()*h,
          r: (Math.random()*1.2 + .25)*dpr,
          a: Math.random()*.55 + .12,
          s: (Math.random()*.32 + .06)*dpr,
          tw: Math.random()*.035 + .01
        }));
      };

      const drawFrame = (t) => {
        if(!running) return;

        if(!last) last = t;
        const dt = t - last;
        last = t;
        acc += dt;
        if(acc < 33) { requestAnimationFrame(drawFrame); return; } // ~30fps
        acc = 0;

        ctx.clearRect(0,0,w,h);
        const g = ctx.createRadialGradient(w*0.5, h*0.4, 0, w*0.5, h*0.4, Math.max(w,h)*0.65);
        g.addColorStop(0, "rgba(255,255,255,0.015)");
        g.addColorStop(1, "rgba(0,0,0,0.20)");
        ctx.fillStyle = g;
        ctx.fillRect(0,0,w,h);

        for(const st of stars){
          st.y += st.s;
          if(st.y > h+20){ st.y=-20; st.x=Math.random()*w; }
          const tw = 0.5 + 0.5*Math.sin(t*st.tw);
          const alpha = st.a*(0.6 + tw*0.4);
          ctx.beginPath();
          ctx.arc(st.x, st.y, st.r, 0, Math.PI*2);
          ctx.fillStyle = `rgba(255,255,255,${alpha})`;
          ctx.fill();
        }

        requestAnimationFrame(drawFrame);
      };

      document.addEventListener("visibilitychange", () => {
        running = !document.hidden;
        if(running) requestAnimationFrame(drawFrame);
      });

      addEventListener("resize", resize, {passive:true});
      resize();
      requestAnimationFrame(drawFrame);

      return { resize };
    }

    // ===== Performance toggle =====
    function applyPerf(){
      // hide aurora when perf off (max smooth)
      $$(".aurora").forEach(a => a.style.display = state.perf ? "block" : "none");
      $("#perfBtn").textContent = `Performance: ${state.perf ? "ON" : "MAX"}`;
      save();
    }

    // ===== Letter (surprise) =====
    let typingRunning = false;

    function letterText(){
      const n = state.name || "‡πÇ‡∏≠‡∏õ‡∏≠";
      const date = state.dateISO ? prettyDate(state.dateISO) : "‡∏ß‡∏±‡∏ô‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤";
      return [
        `${n}‚Ä¶ ‡∏™‡∏∏‡∏Ç‡∏™‡∏±‡∏ô‡∏ï‡πå‡∏ß‡∏±‡∏ô‡∏Ñ‡∏£‡∏ö‡∏£‡∏≠‡∏ö‡∏ô‡∏∞ üíó`,
        `‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏£‡∏≤‡πÅ‡∏≠‡∏ö‡∏ó‡∏≥‡πÄ‡∏ß‡πá‡∏ö‡∏ô‡∏µ‡πâ‡πÑ‡∏ß‡πâ‡πÉ‡∏´‡πâ‡πÄ‡∏ò‡∏≠ ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏≠‡∏¢‡∏≤‡∏Å‡πÉ‡∏´‡πâ ${date} ‡πÄ‡∏õ‡πá‡∏ô‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏û‡∏¥‡πÄ‡∏®‡∏©‡∏Ç‡∏∂‡πâ‡∏ô‡∏≠‡∏µ‡∏Å‡∏ô‡∏¥‡∏î`,
        "‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏±‡∏ô ‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏à‡∏∞‡∏ß‡∏±‡∏ô‡∏î‡∏µ‡∏´‡∏£‡∏∑‡∏≠‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏ô‡∏∑‡πà‡∏≠‡∏¢",
        `‡πÄ‡∏£‡∏≤‡∏≠‡∏≤‡∏à‡πÑ‡∏°‡πà‡πÄ‡∏Å‡πà‡∏á‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏ß‡∏≤‡∏ô ‡πÅ‡∏ï‡πà‡πÄ‡∏£‡∏≤‡πÄ‡∏Å‡πà‡∏á‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á ‚Äú‡∏£‡∏±‡∏Å${n}‚Äù ‡∏à‡∏£‡∏¥‡∏á‡πÜ`,
        "‡∏Ç‡∏≠‡πÉ‡∏´‡πâ‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏ô‡∏µ‡πâ ‡πÄ‡∏£‡∏≤‡πÑ‡∏î‡πâ‡∏¢‡∏¥‡πâ‡∏°‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏±‡∏ô‡πÑ‡∏õ‡∏≠‡∏µ‡∏Å‡∏ô‡∏≤‡∏ô‡πÜ ‡∏ô‡∏∞"
      ].join("\n\n");
    }

    async function typewriter(el, text, speed=16){
      el.textContent = "";
      for(let i=0;i<text.length;i++){
        el.textContent += text[i];
        const jitter = (i%11===0)? 35:0;
        await new Promise(r=>setTimeout(r, speed + jitter));
      }
    }

    function resetLetterUI(){
      typingRunning = false;
      $("#envelope").classList.remove("open");
      $("#typed").textContent = "";
      $("#typedHint").textContent = "‡∏Å‡∏î‡∏ó‡∏µ‡πà‡∏ã‡∏≠‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î üíå";
      $("#toTimelineBtn").disabled = true;
    }

    async function openEnvelopeAndType(){
      if(typingRunning) return;
      typingRunning = true;

      $("#envelope").classList.add("open");
      $("#typedHint").textContent = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏õ‡∏¥‡∏î‡∏à‡∏î‡∏´‡∏°‡∏≤‡∏¢‚Ä¶";

      await new Promise(r=>setTimeout(r, 420));
      await typewriter($("#typed"), letterText(), 16);

      $("#typedHint").textContent = "‡∏≠‡πà‡∏≤‡∏ô‡∏à‡∏ö‡πÅ‡∏•‡πâ‡∏ß ‡∏Å‡∏î‡πÑ‡∏õ‡∏î‡∏π Timeline ‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢ ü´∂";
      $("#toTimelineBtn").disabled = false;
      typingRunning = false;
    }

    // ===== Timeline Í≥ÑÏÇ∞ =====
    function toLocalNoon(d){
      // ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô timezone ‡πÄ‡∏û‡∏µ‡πâ‡∏¢‡∏ô: ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏á‡∏ß‡∏±‡∏ô
      return new Date(d.getFullYear(), d.getMonth(), d.getDate(), 12, 0, 0, 0);
    }

    function parseISODate(iso){
      // iso: YYYY-MM-DD
      const [y,m,dd] = iso.split("-").map(Number);
      if(!y || !m || !dd) return null;
      return new Date(y, m-1, dd);
    }

    function daysBetween(a, b){
      const A = toLocalNoon(a).getTime();
      const B = toLocalNoon(b).getTime();
      return Math.floor((B - A) / 86400000);
    }

    function prettyDate(iso){
      const d = parseISODate(iso);
      if(!d) return "‚Äî";
      return d.toLocaleDateString("th-TH", { year:"numeric", month:"long", day:"numeric" });
    }

    function nextAnniversary(start){
      const now = new Date();
      const s = toLocalNoon(start);
      const yearNow = now.getFullYear();

      // ‡∏Ñ‡∏£‡∏ö‡∏£‡∏≠‡∏ö‡πÅ‡∏ö‡∏ö "‡∏ó‡∏∏‡∏Å‡∏õ‡∏µ‡∏ß‡∏±‡∏ô‡πÄ‡∏î‡∏¥‡∏°"
      let next = new Date(yearNow, s.getMonth(), s.getDate());
      next = toLocalNoon(next);
      if(daysBetween(now, next) < 0) {
        next = new Date(yearNow + 1, s.getMonth(), s.getDate());
        next = toLocalNoon(next);
      }
      return next;
    }

    function renderTimeline(){
      const d = state.dateISO ? parseISODate(state.dateISO) : null;
      const now = new Date();

      if(!d){
        $("#daysTogether").textContent = "‚Äî";
        $("#daysToNext").textContent = "‚Äî";
        $("#datePretty").textContent = "‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÉ‡∏™‡πà‡∏ß‡∏±‡∏ô";
        return;
      }

      const together = Math.max(0, daysBetween(d, now));
      const next = nextAnniversary(d);
      const toNext = Math.max(0, daysBetween(now, next));

      $("#daysTogether").textContent = String(together);
      $("#daysToNext").textContent = String(toNext);
      $("#datePretty").textContent = prettyDate(state.dateISO);
    }

    // ===== Gifts unlock =====
    const gifts = [
      { title:"‡∏Ç‡∏≠‡∏á‡∏Ç‡∏ß‡∏±‡∏ç‡∏ä‡∏¥‡πâ‡∏ô‡∏ó‡∏µ‡πà 1", body:"‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏≤‡∏Å‡πÉ‡∏´‡πâ‡πÄ‡∏ò‡∏≠‡πÑ‡∏î‡πâ‡∏ó‡∏∏‡∏Å‡∏ß‡∏±‡∏ô ‡∏Ñ‡∏∑‡∏≠ ‚Äò‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏ö‡∏≤‡∏¢‡πÉ‡∏à‚Äô" },
      { title:"‡∏Ç‡∏≠‡∏á‡∏Ç‡∏ß‡∏±‡∏ç‡∏ä‡∏¥‡πâ‡∏ô‡∏ó‡∏µ‡πà 2", body:"‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô‡∏ó‡∏µ‡∏°‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡πÄ‡∏ò‡∏≠‡πÄ‡∏™‡∏°‡∏≠ ‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏≠‡∏∞‡πÑ‡∏£‡∏à‡∏∞‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô" },
      { title:"‡∏Ç‡∏≠‡∏á‡∏Ç‡∏ß‡∏±‡∏ç‡∏ä‡∏¥‡πâ‡∏ô‡∏ó‡∏µ‡πà 3", body:"‡∏£‡∏±‡∏Å‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏î‡∏±‡∏á‚Ä¶ ‡πÅ‡∏ï‡πà‡∏°‡∏±‡∏ô ‚Äò‡∏à‡∏£‡∏¥‡∏á‚Äô ‡∏°‡∏≤‡∏Å" },
      { title:"‡∏Ç‡∏≠‡∏á‡∏Ç‡∏ß‡∏±‡∏ç‡∏ä‡∏¥‡πâ‡∏ô‡∏ó‡∏µ‡πà 4", body:"‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏Ç‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏ò‡∏≠‡∏¢‡∏¥‡πâ‡∏°‡πÄ‡∏¢‡∏≠‡∏∞‡πÜ ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡πÄ‡∏ò‡∏≠‡∏™‡∏ß‡∏¢‡∏ï‡∏≠‡∏ô‡∏¢‡∏¥‡πâ‡∏°‡∏°‡∏≤‡∏Å" },
      { title:"‡∏Ç‡∏≠‡∏á‡∏Ç‡∏ß‡∏±‡∏ç‡∏ä‡∏¥‡πâ‡∏ô‡∏ó‡∏µ‡πà 5", body:"‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏Ñ‡∏≥‡∏ß‡πà‡∏≤ ‚Äò‡∏ö‡πâ‡∏≤‡∏ô‚Äô ‡∏≠‡∏ö‡∏≠‡∏∏‡πà‡∏ô‡∏Ç‡∏∂‡πâ‡∏ô" },
      { title:"‡∏Ç‡∏≠‡∏á‡∏Ç‡∏ß‡∏±‡∏ç‡∏ä‡∏¥‡πâ‡∏ô‡∏ó‡∏µ‡πà 6", body:"‡πÄ‡∏£‡∏≤‡∏≠‡∏¢‡∏≤‡∏Å‡πÑ‡∏õ‡∏Ñ‡∏£‡∏ö‡∏£‡∏≠‡∏ö‡∏õ‡∏µ‡∏ñ‡∏±‡∏î‡πÜ ‡πÑ‡∏õ‡∏Å‡∏±‡∏ö‡πÄ‡∏ò‡∏≠" }
    ];

    function revealedCount(){
      return Object.values(state.revealed || {}).filter(Boolean).length;
    }

    function renderGifts(){
      const grid = $("#grid");
      const unlockBtn = $("#unlockBtn");
      const need = 3;

      grid.innerHTML = "";
      gifts.forEach((c, idx) => {
        const revealed = !!state.revealed[idx];
        const el = document.createElement("div");
        el.className = `memCard ${revealed ? "revealed" : "locked"}`;
        el.innerHTML = `<h4>${c.title}</h4><p>${c.body}</p>`;

        el.addEventListener("click", () => {
          state.revealed[idx] = true;
          save();
          el.classList.remove("locked");
          el.classList.add("revealed");
          if(revealedCount() >= need) unlockBtn.disabled = false;
        });

        grid.appendChild(el);
      });

      unlockBtn.disabled = !(revealedCount() >= need);
    }

    // ===== Finale =====
    const finaleLines = [
      "‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô ‚Äò‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏î‡∏µ‡πÜ‚Äô ‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤‡πÄ‡∏™‡∏°‡∏≠",
      "‡∏™‡∏∏‡∏Ç‡∏™‡∏±‡∏ô‡∏ï‡πå‡∏ß‡∏±‡∏ô‡∏Ñ‡∏£‡∏ö‡∏£‡∏≠‡∏ö‡∏ô‡∏∞‚Ä¶ ‡∏≠‡∏¢‡∏≤‡∏Å‡∏à‡∏±‡∏ö‡∏°‡∏∑‡∏≠‡πÑ‡∏õ‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏¢‡πÜ",
      "‡πÄ‡∏£‡∏≤‡∏£‡∏±‡∏Å‡πÄ‡∏ò‡∏≠‡∏°‡∏≤‡∏Å‡∏Ç‡∏∂‡πâ‡∏ô‡∏Å‡∏ß‡πà‡∏≤‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ß‡∏≤‡∏ô ‡πÅ‡∏•‡∏∞‡∏ô‡πâ‡∏≠‡∏¢‡∏Å‡∏ß‡πà‡∏≤‡∏û‡∏£‡∏∏‡πà‡∏á‡∏ô‡∏µ‡πâ‡∏ô‡∏¥‡∏î‡∏ô‡∏∂‡∏á",
      "‡∏Ç‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏≤‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∏‡∏Ç‡πÅ‡∏ö‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏á‡πà‡∏≤‡∏¢ ‡πÅ‡∏ï‡πà‡∏¢‡∏≤‡∏ß‡∏ô‡∏≤‡∏ô",
      "‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡∏ö‡∏≠‡∏Å‡∏£‡∏±‡∏Å‡∏î‡∏±‡∏á‡πÜ ‡πÑ‡∏î‡πâ‡πÑ‡∏´‡∏° üôÇ",
      "‡πÄ‡∏ò‡∏≠‡∏Ñ‡∏∑‡∏≠‡∏Ñ‡∏ô‡πÇ‡∏õ‡∏£‡∏î‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤‚Ä¶‡∏ï‡∏•‡∏≠‡∏î‡πÑ‡∏õ"
    ];

    function xmur3(str){
      let h = 1779033703 ^ str.length;
      for(let i=0;i<str.length;i++){
        h = Math.imul(h ^ str.charCodeAt(i), 3432918353);
        h = (h << 13) | (h >>> 19);
      }
      return () => {
        h = Math.imul(h ^ (h >>> 16), 2246822507);
        h = Math.imul(h ^ (h >>> 13), 3266489909);
        return (h ^= h >>> 16) >>> 0;
      };
    }
    function mulberry32(a){
      return () => {
        let t = (a += 0x6D2B79F5);
        t = Math.imul(t ^ (t >>> 15), t | 1);
        t ^= t + Math.imul(t ^ (t >>> 7), t | 61);
        return ((t ^ (t >>> 14)) >>> 0) / 4294967296;
      };
    }
    function getSignature(){
      const base = `${state.name||"opal"}|${state.dateISO||"no-date"}|${new Date().toISOString().slice(0,10)}|v1`;
      const seed = xmur3(base)();
      const rand = mulberry32(seed);
      const hex = () => Math.floor(rand()*0xffffffff).toString(16).padStart(8,"0");
      return `sig-${hex()}-${hex()}-${hex()}`;
    }

    function refreshFinale(){
      const rnd = mulberry32(xmur3(`${Date.now()}|${state.name}|${state.dateISO}`)());
      const idx = Math.floor(rnd() * finaleLines.length);
      $("#randomLine").textContent = finaleLines[idx];
      $("#hashLine").textContent = `// ${getSignature()}`;
    }

    // ===== Confetti =====
    function confettiBurst(){
      const n = 120;
      const wrap = document.createElement("div");
      wrap.style.position="fixed";
      wrap.style.inset="0";
      wrap.style.pointerEvents="none";
      wrap.style.overflow="hidden";
      document.body.appendChild(wrap);

      const w = innerWidth, h = innerHeight;
      for(let i=0;i<n;i++){
        const s = document.createElement("span");
        s.textContent = Math.random() > .5 ? "‚ù§" : "‚ú¶";
        s.style.position="absolute";
        s.style.left = `${w*0.5 + (Math.random()-0.5)*80}px`;
        s.style.top  = `${h*0.35 + (Math.random()-0.5)*60}px`;
        s.style.fontSize = `${12 + Math.random()*18}px`;
        s.style.opacity="0.95";
        s.style.filter="drop-shadow(0 10px 18px rgba(0,0,0,.25))";
        wrap.appendChild(s);

        const dx = (Math.random()-0.5)*600;
        const dy = (Math.random()-0.5)*400 - 250;
        const dur = 900 + Math.random()*600;

        s.animate(
          [
            { transform:`translate(0,0) rotate(0deg)`, opacity:1 },
            { transform:`translate(${dx}px, ${dy}px) rotate(${720 + Math.random()*720}deg)`, opacity:0 }
          ],
          { duration: dur, easing:"cubic-bezier(.2,.7,.2,1)", fill:"forwards" }
        );
      }
      setTimeout(()=>wrap.remove(), 1800);
    }

    // ===== Init =====
    document.addEventListener("DOMContentLoaded", () => {
      load();
      initTimeChip();
      const stars = initStars();

      // apply perf mode
      applyPerf();

      // restore inputs
      syncNames();
      syncProgressUI();

      // restore route
      const page = (location.hash || "#home").slice(1);
      if(["home","letter","timeline","gifts","finale"].includes(page)) showPage(page);
      else showPage("home");

      // nav buttons
      $$("[data-nav]").forEach(btn => btn.addEventListener("click", () => showPage(btn.dataset.nav)));

      // perf button
      $("#perfBtn").addEventListener("click", () => {
        state.perf = !state.perf;      // ON = ‡∏™‡∏ß‡∏¢‡∏õ‡∏Å‡∏ï‡∏¥, MAX = ‡∏õ‡∏¥‡∏î aurora
        applyPerf();
        stars?.resize?.();
      });

      // start
      $("#startBtn").addEventListener("click", () => {
        state.name = ($("#nameInput").value || "").trim() || "‡πÇ‡∏≠‡∏õ‡∏≠";
        state.dateISO = ($("#dateInput").value || "").trim();
        save();
        syncNames();
        showPage("letter");
      });

      $("#skipBtn").addEventListener("click", () => {
        state.name = ($("#nameInput").value || "").trim() || state.name || "‡πÇ‡∏≠‡∏õ‡∏≠";
        state.dateISO = ($("#dateInput").value || "").trim() || state.dateISO || "";
        save();
        syncNames();
        showPage("timeline");
      });

      // envelope click
      $("#envelope").addEventListener("click", openEnvelopeAndType);

      // next buttons
      $("#toTimelineBtn").addEventListener("click", () => showPage("timeline"));
      $("#toGiftsBtn").addEventListener("click", () => showPage("gifts"));
      $("#unlockBtn").addEventListener("click", () => showPage("finale"));

      // finale actions
      $("#regenBtn").addEventListener("click", refreshFinale);
      $("#kissBtn").addEventListener("click", () => {
        confettiBurst();
        const n = state.name || "‡πÇ‡∏≠‡∏õ‡∏≠";
        alert(`‡∏™‡∏∏‡∏Ç‡∏™‡∏±‡∏ô‡∏ï‡πå‡∏ß‡∏±‡∏ô‡∏Ñ‡∏£‡∏ö‡∏£‡∏≠‡∏ö‡∏ô‡∏∞ ${n} üíû\n‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏±‡∏ô`);
      });
    });
  </script>
</body>
</html>

